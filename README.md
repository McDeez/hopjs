# HopJS

HopJS is a RESTful based declarative API framework for Node.js that:
  * Supports Android, and Shell client side stub generation
  * Generates easy to use browser side API hooks
  * Has a declartive testing interface, which can generate native unit tests in JavaScript and Shell code
  * Generates it's own API documentation
  * Supports caching of results using Redis
  * Supports event based APIs using Socket.io 

*First, we simply define the interface you wish to expose*
(either as static methods on an object or as a proper Javascript class)
```javascript

UserService={};

//All functions backed by HopJS should have a signature of (input,onComplete,request)
UserService.create=function(input,onComplete){
  // Here we would create a new user and call onComplete(err,result) when were done
}

UserService.authenicate=function(input,onComplete){
  // Here we would authenticate a user and call onComplete(err,result) when were done
}

```
*Next, we use Hop to define the interface, this will expose the interface via a RESTful API*

```javascript

//This will create a RESTful set of URLs which expose the following functions:
Hop.defineClass("UserService",UserService,function(api){
  api.post("create","/user").demand("email").demand("username").usage("Create a new user");
  api.post("authenticate","/user/auth").demand("email").demand("username").usage("Authenticate a user");
});

//Now tell HopJS to expose our API in express.js
Hop.exposeAPI("/api/",app)

```

Now that we've done that we get a few things:
 * We have our RESTful API
 * HopJS generates a client side API we can use in our browser which will have the following definitions:
   * UserService.create(input,onComplete)
   * UserService.authenticate(input,onComplete)

So now our website has:
```shell
  # An API for UserService.create 
  POST /api/user
  # An API for UserService.authenticate
  POST /api/user/authenticate
  # Documentation for our API as generated by HopJS with online unit tests
  GET /api/ 
  # A jQuery based client set of stubs for our API
  GET /api/api.js
  # A json definition of our API for client side stub generation
  GET /api/api.json
```

*But we can also define the test cases for our new interface!*

```javascript

Hop.defineTestCase("UserService.authenticate",function(test){
    var validUser = { email:"test@test.com", username:"TestUser" };
    test.do("UserService.create").with(validUser).noError();
    test.do("UserService.authenticate").with(validUser).noError();
    test.do("UserService.authenticate").with({password:"BOB"},validUser).hasError(/Permission denied/);
});

```
*Now let's suppose we wanted an Android set of client stubs for our API:*

```shell
hopjs-gen -url http://www.website.com:3000/ android -outputDir ./androidApp -package com.website.www
```

*Let's also generate a shell script for using our new API*

```shell
# This will create a shell script which uses curl to call our API
hopjs-gen -url http://www.website.com:3000/ shell -output api.sh

./api.sh UserService.create -APIURL http://www.website.com:3000/ --email user@user.com --username foo
```
*We can also generate a unit test for our shell script*
```shell
# This will create a shell script which runs our unit tests on our shell script
hopjs-gen -url http://www.website.com:3000/ shell -unitTest -output test_api.sh

./test_api.sh http://www.website.com:3000/ ./api.sh

```


# Known Issues
 - It is unclear how multiple versions of an API are supported
 - Add more tests

